from = mapANDresults2020,
to = map,
to_id = "PRECINCT",
extensive = TRUE,
weights =block.total,
weight_column = "total.pop",
crs = st_crs(map)
)
View(interpolated.results)
print(mapANDresults2020)
source_geom = head(mapANDresults2020)
print(source_geom)
str(mapANDresults2020)
View(mapANDresults2024)
pres.results.2024 <- read_excel("detail2024.xlsx", sheet = "2",skip=2) %>%
mutate(across(c(1:8,45), as.numeric)) %>%
select(c(1:8,45))
library(dplyr)
library(tidyr)
library(xml2)
library(tidyverse)
library(purrr)
library(sf)
library(RColorBrewer)
library(tidycensus)
library(readxl)
census_api_key("fa67b1dbacf4fbbb1b14c875f34437c6cbdaa694")
# Save dataframe to RDS file
map <- readRDS("map2024.rds")
old.map <- st_zm(st_read("../data/maps/precincts_2020.shp"))
pres.results.2024 <- read_excel("detail2024.xlsx", sheet = "2",skip=2) %>%
mutate(across(c(1:8,45), as.numeric)) %>%
select(c(1:8,45))
colnames(pres.results.2024)<-
c("Precinct.2024","Registered Voters 2024",
"Early.Harris.2024","Election.Harris.2024","Total.Harris.2024",
"Early.Trump.2024","Election.Trump.2024","Total.Trump.2024","Total.2024")
mapANDresults2024 <-
left_join(map, pres.results.2024, by = c("PRC_ID_NAME_short" = "Precinct.2024"))
read_excel("detail2024.xlsx", sheet = "2",skip=2)
pres.results.2024 <- read_excel("detail2024.xlsx", sheet = "2",skip=2) %>%
mutate(across(c(2:8,45), as.numeric)) %>%
select(c(1:8,45))
colnames(pres.results.2024)<-
c("Precinct.2024","Registered Voters 2024",
"Early.Harris.2024","Election.Harris.2024","Total.Harris.2024",
"Early.Trump.2024","Election.Trump.2024","Total.Trump.2024","Total.2024")
View(mapANDresults2024)
colnames(pres.results.2024)<-
c("Precinct.2024","Registered Voters 2024",
"Early.Harris.2024","Election.Harris.2024","Total.Harris.2024",
"Early.Trump.2024","Election.Trump.2024","Total.Trump.2024","Total.2024")
mapANDresults2024 <-
left_join(map, pres.results.2024, by = c("PRC_ID_NAME_short" = "Precinct.2024"))
View(mapANDresults2024)
pres.results.2020 <- read_excel("detail2020.xlsx", sheet = "2",skip=2) %>%
mutate(across(c(2:8,33), as.numeric)) %>%
select(c(1:8,33))
colnames(pres.results.2020)<-
c("Precinct.2020","Registered Voters 2020",
"Early.Biden.2020","Election.Biden.2020","Total.Biden.2020",
"Early.Trump.2020","Election.Trump.2020","Total.Trump.2020","Total.2020")
mapANDresults2020 <-
left_join(old.map, pres.results.2020, by = c("PRECINCT" = "Precinct.2020"))
library(dplyr)
library(tidyr)
library(xml2)
library(tidyverse)
library(purrr)
library(sf)
library(RColorBrewer)
library(tidycensus)
library(readxl)
census_api_key("fa67b1dbacf4fbbb1b14c875f34437c6cbdaa694")
# Save dataframe to RDS file
map <- readRDS("map2024.rds")
old.map <- st_zm(st_read("../data/maps/precincts_2020.shp"))
pres.results.2024 <- read_excel("detail2024.xlsx", sheet = "2",skip=2) %>%
mutate(across(c(2:8,45), as.numeric)) %>%
select(c(1:8,45))
colnames(pres.results.2024)<-
c("Precinct.2024","Registered Voters 2024",
"Early.Harris.2024","Election.Harris.2024","Total.Harris.2024",
"Early.Trump.2024","Election.Trump.2024","Total.Trump.2024","Total.2024")
mapANDresults2024 <-
left_join(map, pres.results.2024, by = c("PRC_ID_NAME_short" = "Precinct.2024"))
pres.results.2020 <- read_excel("detail2020.xlsx", sheet = "2",skip=2) %>%
mutate(across(c(2:8,33), as.numeric)) %>%
select(c(1:8,33))
colnames(pres.results.2020)<-
c("Precinct.2020","Registered Voters 2020",
"Early.Biden.2020","Election.Biden.2020","Total.Biden.2020",
"Early.Trump.2020","Election.Trump.2020","Total.Trump.2020","Total.2020")
mapANDresults2020 <-
left_join(old.map, pres.results.2020, by = c("PRECINCT" = "Precinct.2020"))
block.total <- get_decennial(geography = "block",
state = "Ohio",
county = "Hamilton",
variables = "P1_001N",
year = 2020,
sumfile = "dhc",
geometry = TRUE) %>%
select(total.pop = value) %>%
st_transform(crs = st_crs(map))
block.total %>% ggplot(aes())+ geom_sf()
interpolated.results <- interpolate_pw(
from = st_make_valid(mapANDresults2020),
to = st_make_valid(map),
to_id = "PRECINCT",
extensive = TRUE,
weights =st_make_valid(block.total),
weight_column = "total.pop",
crs = st_crs(map)
)
block.total %>% ggplot(aes())+ geom_sf()
View(interpolated.results)
interpolated.results <- interpolate_pw(
from = st_make_valid(mapANDresults2020),
to = st_make_valid(mapANDresults2024),
to_id = "PRECINCT",
extensive = TRUE,
weights =st_make_valid(block.total),
weight_column = "total.pop",
crs = st_crs(map)
)
View(interpolated.results)
View(interpolated.results)
interpolated.results %>%
mutate(trump.change = Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.chance)) +
geom_sf()+
labs(title = "Difference in Trump support, 2024 vs 2020",
subtitle = ""),
interpolated.results %>%
mutate(trump.change = Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.chance)) +
geom_sf()+
labs(title = "Difference in Trump support, 2024 vs 2020",
subtitle = "",
fill = "",
caption = "")+
scale_fill_gradientn(colours=brewer.pal(n=10,name="RdBu"),na.value = "transparent",
breaks=c(0,.25,0.5,.75,1),labels=c("100% Rep","","50%/50%","","100%Dem"),
)+
theme_void()
# join the 2024 data, so that you have one sf object with a map
# and election results from 2020 and 2024
combined.sf <-
left_join(interpolated.results, pres.results.2024, by = c("PRECINCT" = "PRECINCT"))
View(interpolated.results)
View(mapANDresults2024)
interpolated.results$PRECINCT
# join the 2024 data, so that you have one sf object with a map
# and election results from 2020 and 2024
combined.sf <-
left_join(interpolated.results, mapANDresults2024, by = c("PRECINCT" = "PRECINCT"))
# join the 2024 data, so that you have one sf object with a map
# and election results from 2020 and 2024
combined.sf <-
left_join(interpolated.results, st_drop_geometry(mapANDresults2024), by = c("PRECINCT" = "PRECINCT"))
View(combined.sf)
combined.sf  %>%
mutate(trump.change =Tot/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.chance)) +
geom_sf()+
labs(title = "Difference in Trump support, 2024 vs 2020",
subtitle = "",
fill = "",
caption = "")+
scale_fill_gradientn(colours=brewer.pal(n=10,name="RdBu"),na.value = "transparent",
breaks=c(0,.25,0.5,.75,1),labels=c("100% Rep","","50%/50%","","100%Dem"),
)+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.chance)) +
geom_sf()+
labs(title = "Difference in Trump support, 2024 vs 2020",
subtitle = "",
fill = "",
caption = "")+
scale_fill_gradientn(colours=brewer.pal(n=10,name="RdBu"),na.value = "transparent",
breaks=c(0,.25,0.5,.75,1),labels=c("100% Rep","","50%/50%","","100%Dem"),
)+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Difference in Trump support, 2024 vs 2020",
subtitle = "",
fill = "",
caption = "")+
scale_fill_gradientn(colours=brewer.pal(n=10,name="RdBu"),na.value = "transparent",
breaks=c(0,.25,0.5,.75,1),labels=c("100% Rep","","50%/50%","","100%Dem"),
)+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "",
fill = "",
caption = "")+
scale_fill_gradientn(colours=brewer.pal(n=10,name="RdBu"),na.value = "transparent",
breaks=c(0,.25,0.5,.75,1),labels=c("100% Rep","","50%/50%","","100%Dem"),
)+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "",
fill = "",
caption = "")+
scale_fill_gradientn(colours=brewer.pal(n=10,name="RdBu"),na.value = "transparent")+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=brewer.pal(n=10,name="RdBu"),na.value = "transparent")+
theme_void()
interpolated.results %>%
mutate(dem.prop = dem.overall/overall) %>%
ggplot(aes(fill=dem.prop)) +
geom_sf()+
labs(title = paste(my.race,my.year,sep = ", "),
subtitle = paste(my.dem,' (', overall.results$Overall[1],'%) vs ',my.rep,' (',overall.results$Overall[2],'%)',sep=''),
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent",
breaks=c(0,.25,0.5,.75,1),labels=c("100% Rep","","50%/50%","","100% Dem"),
limits=c(0,1))+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=brewer.pal(n=10,name="RdBu"),na.value = "transparent")+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020)
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020)+ hist(trump.change)
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%  hist(trump.change)
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) -> poo
poo$trump.change
View(poo)
hist(poo$trump.change)
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")+
values = scales::rescale(c(min(combined.sf$trump.change, na.rm = TRUE), 0, max(combined.sf$trump.change, na.rm = TRUE)))+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")+
values = scales::rescale(c(min(combined.sf$trump.change, na.rm = TRUE), 0, max(combined.sf$trump.change, na.rm = TRUE)))+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")+
values = scales::rescale(c(min(combined.sf$trump.change, na.rm = TRUE), 0, max(combined.sf$trump.change, na.rm = TRUE)))
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")+
values = scales::rescale(c(m, 0, M))+
theme_void()
m = min(combined.sf$trump.change, na.rm = TRUE)
M = mx(combined.sf$trump.change, na.rm = TRUE)
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")+
values = scales::rescale(c(m, 0, M))+
theme_void()
m = min(combined.sf$trump.change, na.rm = TRUE)
m = min(combined.sf$trump.change, na.rm = TRUE)
m = min(combined.sf$trump.change, na.rm = TRUE)
M = max(combined.sf$trump.change, na.rm = TRUE)
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")+
values = scales::rescale(c(m, 0, M))+
theme_void()
m =
M =
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")+
values = scales::rescale(c(min(trump.change, na.rm = TRUE), 0, max(trump.change, na.rm = TRUE)))+
theme_void()
m =
M =
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")+
values = scales::rescale(c(min(combined.sf$trump.change, na.rm = TRUE), 0, max(trump.change, na.rm = TRUE)))+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),na.value = "transparent")+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),
values = scales::rescale(c(min(combined.sf$trump.change, na.rm = TRUE),
0,
max(combined.sf$trump.change, na.rm = TRUE))),
na.value = "transparent")+
theme_void()
combined.sf <- combined.sf %>%
mutate(trump.change = Total.Trump.2024 / Total.2024 - Total.Trump.2020 / Total.2020)
m = min(combined.sf$trump.change, na.rm = TRUE)
M = max(combined.sf$trump.change, na.rm = TRUE)
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),
values = scales::rescale(c(m,0,M)),
na.value = "transparent")+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),
values = scales::rescale(c(m,0,M)),
na.value = "transparent",
breaks=c(.15,.10,0.5,0,-.5, -.10)
)+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),
values = scales::rescale(c(m,0,M)),
na.value = "transparent",
breaks=c(.15,.10,0.05,0,-.05, -.10)
)+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),
values = scales::rescale(c(m,0,M)),
na.value = "transparent",
breaks=c(.15,.10,0.05,0,-.05,-.10)
)+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),
values = scales::rescale(c(m,0,M)),
na.value = "transparent",
breaks=c(.15,.10,0.05,0,-.05,-.10),
labels=c("+15%","+10%","+5%","","-5%","-10%")
)+
theme_void()
combined.sf  %>%
mutate(trump.change =Total.Trump.2024/Total.2024 - Total.Trump.2020/Total.2020) %>%
ggplot(aes(fill=trump.change)) +
geom_sf()+
labs(title = "Change in Trump support, 2024 vs 2020",
subtitle = "Trump 2024 (%) - Trump 2020 (%)",
fill = "",
caption = "")+
scale_fill_gradientn(colours=rev(brewer.pal(n=10,name="RdBu")),
values = scales::rescale(c(m,0,M)),
na.value = "transparent",
breaks=c(.15,.10,0.05,0,-.05,-.10),
labels=c("+15%","+10%","+5%","no change","-5%","-10%")
)+
theme_void()
